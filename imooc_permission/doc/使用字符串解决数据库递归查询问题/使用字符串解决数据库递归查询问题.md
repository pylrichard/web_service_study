# 使用字符串解决数据库递归查询问题

## 问题

需要维护一个部门层级结构，每个部门都要存储一个上级部门的parent_id

当查询一个部门的所有子部门时，需要根据parent_id递归查询，层级深的部门需要查询次数特别多

是否可以通过一个简单的设计满足一次查询某个部门的所有子部门

## 解决方案

对于**1.png**的部门层级结构，给出**2.png**的数据库设计

添加一个辅助的varchar字段level，字段的逻辑是多个部门的id使用.来连接，假设首层使用0表示，每一层级=上一层级的level+父部门id

比如UE(id:8)的上级部门是前端开发(id:3)，前端开发的上级部门是技术组(id:1)，因此UE的level是0.1.3，前端开发的level是0.1

查询技术组的所有子部门，只需要使用字符串`0.1.%`查询即可

查询前端开发的所有子部门，只需要使用字符串`0.1.3.*`查询即可，即找到当前部门的level，拼接`.`后，再拼接当前部门id，最后拼接`.%`做后缀模糊匹配

子部门查询的伪代码如下:

```mysql
level like {level}.{id}.%
```

