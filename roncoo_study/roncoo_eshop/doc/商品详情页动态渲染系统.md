## 架构设计

125-大型电商网站的商品详情页系统架构演进

性能问题、全量更新问题、容量问题

126-大型电商网站的商品详情页系统-架构整体设计

127-商品详情页动态渲染系统-架构整体设计

## 4层缓存架构

### 分发层Nginx

distribute_request_route.lua将请求路由到固定应用层Nginx，提高Nginx本地Cache命中率

### 应用层Nginx

app_cache_ha.lua进行读链路多级降级

1 Nginx本地Cache没有获取到数据

1) 获取从集群降级标识

2) 如果要进行从集群降级，访问数据直连服务

​	获取数据直连服务降级标识

​		如果要进行数据直连服务降级，访问Redis主集群，并尝试访问数据直连服务

​		没有降级则访问数据直连服务

3) 没有降级则访问Redis从集群，从集群没有获取到数据，则依次访问数据直连服务和Redis主集群

4) 过期时间在10~20分钟范围内动态生成，避免大量缓存在同一时间失效，发送大量请求访问Redis获取数据

5) 获取到数据后更新Nginx本地Cache

2 渲染HTML

### Redis从集群

140-商品详情页动态渲染系统-给每个机房部署一个Redis从集群

### 数据直连服务

175-商品详情页动态渲染系统-基于Spring Cloud开发数据直连服务

### Redis主集群

139-商品详情页动态渲染系统-部署双机房一主三从架构的Redis主集群

维度化数据分段存储，详情页显示分段加载

### 数据变更

165-商品详情页动态渲染系统-依赖服务进行数据变更

商品服务修改了商品数据，发送数据变更消息到MQ

#### 数据同步服务

166-商品详情页动态渲染系统-基于Spring Cloud开发数据同步服务

169-商品详情页动态渲染系统-消息队列架构升级之去重队列

170-商品详情页动态渲染系统-消息队列架构升级之刷数据与高优先级队列

#### 数据聚合服务

167-商品详情页动态渲染系统-基于Spring Cloud开发数据聚合服务

168-商品详情页动态渲染系统-完成数据同步服务与数据聚合服务的测试